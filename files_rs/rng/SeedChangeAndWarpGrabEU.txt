@@ title = "Change PRNG seed and teleport (Grab ACE, EU)"
@@ author = "final, Theocatic and Mettrich"
@@ exit = "Bootstrapped"
@@ filler4 = 0xffffffff

// This code works with grab ACE, however 0x44fc control code ACE must
// perform extra steps in order for this code to work. Specifically
// the ACE must be triggered while you are in the PC.
//
// This code requires a Box 14 exit code for grab ACE.
// It can be found here:
// https://pomeg-letterbombers.github.io/pokemon-ace-notes/frlg/exit-codes/box-14-exit/
//
// Please note that the linked web page is for FireRed and LeafGreen but
// the exit also works on Ruby and Sapphire. Substitute "STARS" with
// "POLKA-DOT" or whatever the equivalent is in your language.

// The teleportation will occur as soon as you log off the PC.

// The map list can be found here:
// https://pastebin.com/kmrbJY0S

map_id = 0x0000

// `warp` determines which warp point you will teleport to.

warp = 0

// Input the desired RNG state here

seed = 0x0

// Do not touch the below variables

// Teleport script:
//
// 39 YY XX WW 00 00 00 00 warp 0xYY 0xXX 0xWW
// FF @ illegal command, terminates script execution

script = ((warp & 0xff) << 24) | ((map_id & 0xffff) << 8) | 0x39

@@

MOV     r12, #0x3000000         ; sScriptContext1 addressing
ADCS    r10, r12, #0xc500       ; gRngValue addressing

SBC     r11, r12, #0xff         ; Prepare script pointer (in unused EWRAM)
STR     r11, [r12, #0x5c0]!     ; Store pointer in sScriptContext1->scriptPtr

MOV     r12, #{script} ?5       ; Move script
STR     r12, [r11, #0]!         ; Store script

0xe3ffcccc                      ; MVNS r12, #0xcc00
STRH    r12, [r11, #8]          ; Store script end
ADCS    r11, r10, #0x328        ; r11 = &gRngValue, fix CPSR

MOV     r12, #{seed} ?5
STR     r12, [r11, #0]!         ; Store seed in gRngValue
